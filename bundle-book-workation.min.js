(()=>{function ne(e){let o=document.querySelectorAll(".room-price-data"),t=Array.from(o).map(i=>JSON.parse(i.textContent));return e?t.filter(i=>i.editionSlug===e):t}function z(e,o){return!e||!o?0:Math.floor((o-e)/(1e3*60*60*24*30))}function f(e,o){return new Intl.NumberFormat("de-DE",{style:"currency",currency:o,currencyDisplay:"code"}).format(e)}function I(e,o=null){return isNaN(parseFloat(e))?o:parseFloat(e)}function re(){document.querySelectorAll("[data-trigger]").forEach(t=>{t.addEventListener("change",()=>o(t)),o(t)});function o(t){let i=t.getAttribute("data-trigger"),s=t.value;document.querySelectorAll(`[data-condition-trigger="${i}"]`).forEach(r=>{let u=r.getAttribute("data-condition-value")===s,l=r.matches("input, select, textarea")?r:r.querySelector("input, select, textarea");r.style.display=u?"block":"none",l&&(l.required=u,u||(l.value=""))})}}function ie(){document.querySelectorAll("[data-custom-dropdown]").forEach(e=>{let o=document.createElement("input");o.type="hidden",o.name=e.dataset.name||"custom-dropdown",o.setAttribute("required",e.dataset.required==="true"||!1),o.value="",e.appendChild(o);let t=e.querySelector(".dropdown-selected-value");e.querySelectorAll(".dropdown-item").forEach(s=>{s.addEventListener("click",d=>{d.preventDefault();let r=s.dataset.value,u=s.cloneNode(!0);u.style.padding=0,t.innerHTML="",t.appendChild(u),o.value=r})})})}function se(e,o,t=30){let i=document.querySelector(e),s=document.querySelector(o),d=new DateRangePicker(i,{format:"dd. MM yyyy"}),r=t;return d.setMinimumDays=u=>{r=u},d.validateDateRange=()=>{let[u,l]=d.getDates();u&&l&&Math.floor((l-u)/864e5)<r?(s.setCustomValidity(`You need to choose a minimum of ${r} days.`),d.setDates(u,new Date(u.getTime()+r*24*60*60*1e3))):s.setCustomValidity(""),s.reportValidity()},i.addEventListener("changeDate",d.validateDateRange),{rangepicker:d,datesInput:i,startDateField:s}}function he(e){return/^HM\d{6}-\d{3}$/.test(e)}function ce(){let e=document.querySelectorAll(".form-step"),o=document.querySelectorAll(".form-wizard-step .form-wizard-step-progress"),t=0;function i(l){e.forEach((n,c)=>{n.style.display=c===l?"block":"none"}),o.forEach((n,c)=>{c<l||c===l?n.classList.add("active"):n.classList.remove("active")})}function s(){let l=e[t].querySelectorAll("input, select, textarea"),n=[];return l.forEach(c=>{let h=c.type==="hidden"||c.offsetParent===null;if(c.required&&(!c.value||c.value.trim()==="")){let S=c.dataset.name||c.name||c.placeholder||"Unnamed field";n.push(`${S} is required.`)}if(!h&&c.value&&!c.checkValidity()){let y=c.name||c.placeholder||"Unnamed field";n.push(`${y} is invalid.`)}if(c.hasAttribute("data-membership-id")&&c.value&&!he(c.value)){let y=c.dataset.name||c.name||c.placeholder||"Membership ID";n.push(`${y} is not a valid Membership ID.`)}}),n}function d(l,n){let c=document.querySelector(l);if(!c)return;c.innerHTML="";let h=document.createElement("ul");n.forEach(y=>{let S=document.createElement("li");S.textContent=y,h.appendChild(S)}),c.appendChild(h)}function r(l){let n=document.querySelector(l);n&&(n.innerHTML="")}document.querySelectorAll(".form-next-step-btn").forEach(l=>{l.addEventListener("click",()=>{if(l.getAttribute("disabled")==="true")return;let n=s(),c=`#error-list-step-${t}`;r(c),n.length==0?(t=Math.min(t+1,e.length-1),t===e.length-1&&u(),i(t)):d(c,n)})});function u(){document.querySelectorAll('[id^="review-"]').forEach(n=>{let c=n.dataset.fieldname;try{let h=document.querySelector(`[name="${c}"]`).value;n.innerText=h}catch{}})}document.querySelectorAll(".form-previous-step-btn").forEach(l=>{l.addEventListener("click",()=>{t=Math.max(t-1,0),i(t)})}),i(t)}function ae(){document.getElementById("close-button").addEventListener("click",function(){let e=document.referrer,o=window.location.hostname,t=null;try{t=e?new URL(e).hostname:null}catch{t=null}window.history.length>1&&t===o?window.history.back():window.location.href="/"})}var p="EUR",Y=null;function de(e){let o=document.querySelectorAll(".edition-data");return Array.from(o).map(i=>JSON.parse(i.textContent)).find(i=>i.editionSlug===e)||null}function ye(e){let o=document.querySelectorAll(".destination-data");return Array.from(o).map(i=>JSON.parse(i.textContent)).find(i=>i.destinationSlug===e)||null}document.addEventListener("DOMContentLoaded",function(){ae(),re(),ce(),ie(),Y=se("#dates-start-end-group","#Start-Date"),Se(),De(),we(),ge(),xe()});function ge(){let e=new URLSearchParams(window.location.search),o=e.get("destination"),t=e.get("edition"),i=e.get("room"),s=e.get("guests");o&&J("#destination-dropdown",o,"data-destinationslug");let d=t&&J("#edition-dropdown",t,"data-editionslug");if(i&&J("#room-dropdown",i,"data-roomslug"),s){let r=document.getElementById("Guests");r&&(r.value=s)}if(d){let r=d.dataset.startdate,u=d.dataset.enddate,l=d.dataset.editionslug||"",n=Y.rangepicker;n.setOptions({minDate:r,maxDate:u}),n.setDates(r,u),_(l)}}function Se(){let e=document.querySelector("#destination-dropdown"),o=document.querySelector("#edition-dropdown"),t=o.querySelector(".dropdown-selected-value"),i=t.innerHTML,s=document.querySelector("#room-dropdown"),d=s.querySelector(".dropdown-selected-value"),r=e.querySelectorAll(".dropdown-item"),u=o.querySelectorAll(".dropdown-item"),l=s.querySelectorAll(".dropdown-item");function n(c,h){t.setAttribute("disabled",c===""?"true":"false"),d.setAttribute("disabled",c===""?"true":"false"),t.innerHTML=i,d.innerHTML=i,p=h,[...u,...l].forEach(y=>{let S=y.dataset.destinationslug===c;y.style.display=S?"flex":"none"}),_("")}n("",p),r.forEach(c=>{c.addEventListener("click",function(){n(this.dataset.destinationslug,this.dataset.currency)})})}function J(e,o,t){let i=document.querySelectorAll(`${e} .dropdown-item`),s=i&&Array.from(i).find(d=>d.getAttribute(t)===o);return s&&s.click(),s}function De(){let o=document.querySelector("#edition-dropdown").querySelectorAll(".dropdown-item"),t=document.querySelector("#dates-start-end-group");function i(s,d,r){let u=t.rangepicker;u.setOptions({minDate:s,maxDate:d}),u.setDates(s,d),_(r)}o.forEach(s=>{s.addEventListener("click",function(){let d=this.dataset.editionslug||"";i(this.dataset.startdate,this.dataset.enddate,d)})})}function _(e){let o=document.querySelector(".additional-booking-info"),t=document.querySelector(".additional-booking-info-text");if(!o||!t)return;if(!e){o.style.display="none";return}let s=de(e)?.additionalBookingInfo||"";s&&s.trim()!==""?(t.textContent=s,o.style.display=""):o.style.display="none"}function we(){document.querySelector("#dates-start-end-group").addEventListener("changeDate",()=>{M(),le()}),document.querySelector("#room-dropdown").querySelectorAll(".dropdown-item").forEach(u=>{u.addEventListener("click",()=>{M();let l=u.getAttribute("data-allow-weekly-booking"),n=Y.rangepicker;n.setMinimumDays(l==="Enabled"?7:30),n.validateDateRange()})}),document.querySelector("#Guests").addEventListener("change",()=>{M()});let s=document.querySelector("#pet-travel-checkbox"),d=document.querySelector("#pet-count-input");s&&s.addEventListener("change",()=>{M()}),d&&(d.addEventListener("input",()=>{M()}),d.addEventListener("change",()=>{M()}));let r=document.querySelector("#get-membership-checkbox");r&&r.addEventListener("change",()=>{M()})}function xe(){le(),M()}function le(){let o=document.querySelector("#dates-start-end-group").rangepicker,t=document.querySelector(".discount-info-blue"),i=document.querySelector(".discount-info-green"),[s,d]=o.getDates(),r=z(s,d);!s||!d||r<=2?(t.style.display="flex",i.style.display="none"):(t.style.display="none",i.style.display="flex")}function M(){let e=document.querySelectorAll(".price-info-card"),t=document.querySelector("#dates-start-end-group").rangepicker,i=document.querySelector("#destination-dropdown .dropdown-selected-value .dropdown-item"),s=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),d=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item"),r=document.querySelector("#Guests"),u=i?i.dataset.destinationslug:"",l=s?s.dataset.editionslug:"",n=d?d.dataset.roomslug:"",c=d?d.getAttribute("data-allow-weekly-booking")==="Enabled":!1,[h,y]=t.getDates(),S=r?parseInt(r.value):0;if(u&&l&&n&&h&&y&&S>0){let D=ye(u),w=document.querySelector("#pet-travel-section");if(w)if(D&&D.allowPets==="true")w.style.display="flex";else{w.style.display="none";let q=document.querySelector("#pet-travel-checkbox"),C=document.querySelector("#pet-count-input");q&&(q.checked=!1),C&&(C.value="1")}let P=ne();e.forEach(q=>{q.style.display="flex",qe(q,P,l,n,h,y,S,c)});let L={day:"numeric",month:"short",year:"numeric"},R=h.toLocaleDateString("en-GB",{day:"numeric",month:"short"}).replace(",",""),H=y.toLocaleDateString("en-GB",L).replace(",","");document.querySelectorAll(".total-dates").forEach(q=>q.innerHTML=`${R} - ${H}`)}else{e.forEach(w=>w.style.display="none");let D=document.querySelector("#pet-travel-section");D&&(D.style.display="none")}}function qe(e,o,t,i,s,d,r,u){function l(a){return a===1?"st":a===2?"nd":a===3?"rd":"th"}function n(a,m){a&&(a.style.display=m)}function c(a,m,g){!a||!m||(m.style.pointerEvents=g?"auto":"none",m.style.backgroundColor=g?"var(--_colors---primary)":"var(--_colors---light-silver)",m.style.opacity=g?1:.3,a.setAttribute("disabled",!g))}function h(){q.innerText="No room price found for the selected season or room.",n(R,"none"),n(D,"none"),n(w,"none"),n(L?.parentElement,"none"),n(C,"none"),n(P,"none"),c(F,j,!1),Q.forEach(a=>n(a,"none")),G&&(G.value=0)}function y(){n(R,"block"),n(D,"block"),n(L?.parentElement,"flex"),n(C,"block"),n(P,"block"),c(F,j,!0),Q.forEach(a=>n(a,"block"))}let S=z(s,d),D=e.querySelector(".room-price"),w=e.querySelector(".room-price-discount"),P=e.querySelector(".room-price-month-desc"),L=e.querySelector(".total-guests"),R=e.querySelector(".total-totalprice"),H=R.firstElementChild,q=e.querySelector(".room-price-breakdown"),C=e.querySelector(".total-dates"),F=document.querySelector("#form-next-step-btn-step-1"),j=F?F.querySelector("a"):null,T=o.find(a=>a.editionSlug===t&&a.roomSlug===i),Q=e.querySelectorAll(".price-info-card-title"),G=document.querySelector('[name="Total-Price"]');if(!T){h();return}y();let $=de(t),V=I(T.basePriceWeek),O=T.basePriceMonth,ue=T.discountMonth2,me=T.discountMonth3,k=0,x=[],A=Math.round((d-s)/(1e3*60*60*24));if(S<1&&u&&V){n(w,"none"),D.innerText=`${f(V,p)}`,P.innerText="per week";let m=V/7*A;x.push({text:`${A} days: ${f(m,p)}`}),k=m;let g=I(T.surcharge2ndPerson,0);if(r===2&&g>0){let b=g/30*A;b>0&&(x.push({text:`2nd person surcharge: ${f(b,p)}`}),k+=b)}}else if(S>=1){let a=A,m=1,g=0,ee=0,b=0,te=I(T.surcharge2ndPerson,0),oe=r===2&&te>0;for(;a>0;){let E=0;m===1?E=0:m===2?E=ue:m>=3&&(E=me),g=E;let B=a>=30?30:a;ee=B;let W=O*(1-E/100)/30*B;if(k+=W,x.push({text:B===30?`Month ${m}: ${f(W,p)}`:`+ ${a} days: ${f(W,p)}`,discount:E,month:m}),oe){let fe=te*(1-E/100)/30*B;b+=fe}a-=B,m++}let v=x[x.length-1];if(v&&v.discount!==void 0&&v.discount>0){let E=v.month<=3?`${v.month}${l(v.month)} month`:"from 3rd month";w.innerText=`${v.discount.toFixed(1)}% discount - ${E}`,n(w,"flex"),D.innerText=`${f(O*(1-v.discount/100),p)}`,P.innerText=E}else n(w,"none"),D.innerText=`${f(O,p)}`,P.innerText="1st month";oe&&b>0&&(x.push({text:`2nd person surcharge: ${f(b,p)}`}),k+=b)}let U=0;if($){if(A>=1&&$.taxFirstMonth){let a=I($.taxFirstMonth,0);a>0&&(U+=a*r,x.push({text:`${r===1?"Tax":`${r} x Tax`} (1st month): ${f(a,p)}`}))}if(A>30&&$.taxSecondMonth){let a=I($.taxSecondMonth,0);a>0&&(U+=a*r,x.push({text:`${r===1?"Tax":`${r} x Tax`} (2nd month): ${f(a,p)}`}))}}k+=U;let N=0,K=document.querySelector("#pet-travel-checkbox"),X=document.querySelector("#pet-count-input");if(K&&K.checked&&X&&$){let a=parseInt(X.value)||0,m=I($.petPricePerMonth,0);if(a>0&&m>0){let g=A/30;N=m*g*a,N>0&&x.push({text:`Pet${a>1?"s":""} (${a} \xD7 ${g.toFixed(1)} month${g!==1?"s":""}): ${f(N,p)}`})}}k+=N;let Z=document.querySelector("#get-membership-checkbox"),pe=80;if(Z&&Z.checked){let a=pe*r,m=r===1?`1 Year Membership: ${f(a,p)}`:`${r} x 1 Year Membership: ${f(a,p)}`;x.push({text:m}),k+=a}q.innerHTML=x.map(a=>a.text).join("<br>"),L.innerText=`${r} x Person`,H.innerText=`${f(k,p)}`,G&&(G.value=`${f(k,p)}`)}})();
