(()=>{function z(e){let o=document.querySelectorAll(".room-price-data"),t=Array.from(o).map(c=>JSON.parse(c.textContent));return e?t.filter(c=>c.editionSlug===e):t}function J(e,o){return!e||!o?0:Math.floor((o-e)/(1e3*60*60*24*30))}function h(e,o){return new Intl.NumberFormat("de-DE",{style:"currency",currency:o,currencyDisplay:"code"}).format(e)}function A(e,o=null){return isNaN(parseFloat(e))?o:parseFloat(e)}function re(){document.querySelectorAll("[data-trigger]").forEach(t=>{t.addEventListener("change",()=>o(t)),o(t)});function o(t){let c=t.getAttribute("data-trigger"),n=t.value;document.querySelectorAll(`[data-condition-trigger="${c}"]`).forEach(r=>{let l=r.getAttribute("data-condition-value")===n,u=r.matches("input, select, textarea")?r:r.querySelector("input, select, textarea");r.style.display=l?"block":"none",u&&(u.required=l,l||(u.value=""))})}}function se(){document.querySelectorAll("[data-custom-dropdown]").forEach(e=>{let o=document.createElement("input");o.type="hidden",o.name=e.dataset.name||"custom-dropdown",o.setAttribute("required",e.dataset.required==="true"||!1),o.value="",e.appendChild(o);let t=e.querySelector(".dropdown-selected-value");e.querySelectorAll(".dropdown-item").forEach(n=>{n.addEventListener("click",s=>{s.preventDefault();let r=n.dataset.value,l=n.cloneNode(!0);l.style.padding=0,t.innerHTML="",t.appendChild(l),o.value=r})})})}function ie(e,o,t=30){let c=document.querySelector(e),n=document.querySelector(o),s=new DateRangePicker(c,{format:"dd. MM yyyy"}),r=t;return s.setMinimumDays=l=>{r=l},s.validateDateRange=()=>{let[l,u]=s.getDates();l&&u&&Math.floor((u-l)/864e5)<r?(n.setCustomValidity(`You need to choose a minimum of ${r} days.`),s.setDates(l,new Date(l.getTime()+r*24*60*60*1e3))):n.setCustomValidity(""),n.reportValidity()},c.addEventListener("changeDate",s.validateDateRange),{rangepicker:s,datesInput:c,startDateField:n}}function ge(e){return/^HM\d{6}-\d{3}$/.test(e)}function ce(){let e=document.querySelectorAll(".form-step"),o=document.querySelectorAll(".form-wizard-step .form-wizard-step-progress"),t=0;function c(u){e.forEach((i,a)=>{i.style.display=a===u?"block":"none"}),o.forEach((i,a)=>{a<u||a===u?i.classList.add("active"):i.classList.remove("active")})}function n(){let u=e[t].querySelectorAll("input, select, textarea"),i=[];return u.forEach(a=>{let p=a.type==="hidden"||a.offsetParent===null;if(a.required&&(!a.value||a.value.trim()==="")){let S=a.dataset.name||a.name||a.placeholder||"Unnamed field";i.push(`${S} is required.`)}if(!p&&a.value&&!a.checkValidity()){let f=a.name||a.placeholder||"Unnamed field";i.push(`${f} is invalid.`)}if(a.hasAttribute("data-membership-id")&&a.value&&!ge(a.value)){let f=a.dataset.name||a.name||a.placeholder||"Membership ID";i.push(`${f} is not a valid Membership ID.`)}}),i}function s(u,i){let a=document.querySelector(u);if(!a)return;a.innerHTML="";let p=document.createElement("ul");i.forEach(f=>{let S=document.createElement("li");S.textContent=f,p.appendChild(S)}),a.appendChild(p)}function r(u){let i=document.querySelector(u);i&&(i.innerHTML="")}document.querySelectorAll(".form-next-step-btn").forEach(u=>{u.addEventListener("click",()=>{if(u.getAttribute("disabled")==="true")return;let i=n(),a=`#error-list-step-${t}`;r(a),i.length==0?(t=Math.min(t+1,e.length-1),t===e.length-1&&l(),c(t)):s(a,i)})});function l(){document.querySelectorAll('[id^="review-"]').forEach(i=>{let a=i.dataset.fieldname;try{let p=document.querySelector(`[name="${a}"]`).value;i.innerText=p}catch{}})}document.querySelectorAll(".form-previous-step-btn").forEach(u=>{u.addEventListener("click",()=>{t=Math.max(t-1,0),c(t)})}),c(t)}function ae(){document.getElementById("close-button").addEventListener("click",function(){let e=document.referrer,o=window.location.hostname,t=null;try{t=e?new URL(e).hostname:null}catch{t=null}window.history.length>1&&t===o?window.history.back():window.location.href="/"})}var g="EUR",_=null;function de(e){let o=document.querySelectorAll(".edition-data");return Array.from(o).map(c=>JSON.parse(c.textContent)).find(c=>c.editionSlug===e)||null}function Se(e){let o=document.querySelectorAll(".destination-data");return Array.from(o).map(c=>JSON.parse(c.textContent)).find(c=>c.destinationSlug===e)||null}document.addEventListener("DOMContentLoaded",function(){ae(),re(),ce(),se(),_=ie("#dates-start-end-group","#Start-Date"),De(),xe(),qe(),we(),Ee(),ue()});function we(){let e=new URLSearchParams(window.location.search),o=e.get("destination"),t=e.get("edition"),c=e.get("room"),n=e.get("guests");o&&Y("#destination-dropdown",o,"data-destinationslug");let s=t&&Y("#edition-dropdown",t,"data-editionslug");if(c&&Y("#room-dropdown",c,"data-roomslug"),n){let r=document.getElementById("Guests");r&&(r.value=n)}if(s){let r=s.dataset.startdate,l=s.dataset.enddate,u=s.dataset.editionslug||"",i=_.rangepicker;i.setOptions({minDate:r,maxDate:l}),i.setDates(r,l),j(u)}}function De(){let e=document.querySelector("#destination-dropdown"),o=document.querySelector("#edition-dropdown"),t=o.querySelector(".dropdown-selected-value"),c=t.innerHTML,n=document.querySelector("#room-dropdown"),s=n.querySelector(".dropdown-selected-value"),r=e.querySelectorAll(".dropdown-item"),l=o.querySelectorAll(".dropdown-item"),u=n.querySelectorAll(".dropdown-item");function i(a,p){t.setAttribute("disabled",a===""?"true":"false"),s.setAttribute("disabled",a===""?"true":"false"),t.innerHTML=c,s.innerHTML=c;let f=document.getElementById("Guests");f&&(f.disabled=!1),g=p,[...l,...u].forEach(S=>{let w=S.dataset.destinationslug===a;S.style.display=w?"flex":"none"}),j("")}i("",g),r.forEach(a=>{a.addEventListener("click",function(){i(this.dataset.destinationslug,this.dataset.currency)})})}function Y(e,o,t){let c=document.querySelectorAll(`${e} .dropdown-item`),n=c&&Array.from(c).find(s=>s.getAttribute(t)===o);return n&&n.click(),n}function xe(){let o=document.querySelector("#edition-dropdown").querySelectorAll(".dropdown-item"),t=document.querySelector("#dates-start-end-group");function c(n,s,r){let l=t.rangepicker;l.setOptions({minDate:n,maxDate:s}),l.setDates(n,s),j(r)}o.forEach(n=>{n.addEventListener("click",function(){let s=this.dataset.editionslug||"";c(this.dataset.startdate,this.dataset.enddate,s);let r=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item");r&&me(r)})})}function j(e){let o=document.querySelector(".additional-booking-info"),t=document.querySelector(".additional-booking-info-text");if(!o||!t)return;if(!e){o.style.display="none";return}let n=de(e)?.additionalBookingInfo||"";n&&n.trim()!==""?(t.textContent=n,o.style.display=""):o.style.display="none"}function qe(){document.querySelector("#dates-start-end-group").addEventListener("changeDate",()=>{I(),le()}),document.querySelector("#room-dropdown").querySelectorAll(".dropdown-item").forEach(l=>{l.addEventListener("click",()=>{I();let u=l.getAttribute("data-allow-weekly-booking"),i=_.rangepicker;i.setMinimumDays(u==="Enabled"?7:30),i.validateDateRange(),me(l)})}),document.querySelector("#Guests").addEventListener("change",()=>{I(),ue()});let n=document.querySelector("#pet-travel-checkbox"),s=document.querySelector("#pet-count-input");n&&n.addEventListener("change",()=>{I()}),s&&(s.addEventListener("input",()=>{I()}),s.addEventListener("change",()=>{I()}));let r=document.querySelector("#get-membership-checkbox");r&&r.addEventListener("change",()=>{I()})}function Ee(){le(),I()}function le(){let o=document.querySelector("#dates-start-end-group").rangepicker,t=document.querySelector(".discount-info-blue"),c=document.querySelector(".discount-info-green"),[n,s]=o.getDates(),r=J(n,s);!n||!s||r<=2?(t.style.display="flex",c.style.display="none"):(t.style.display="none",c.style.display="flex")}function ue(){let e=document.querySelector("#Guests"),o=document.getElementById("second-guest-details-wrapper");if(!o)return;let t=e?parseInt(e.value):1,n=["Name-Second-Guest","Last-Name-Second-Guest","Email-Second-Guest"].map(s=>document.getElementById(s)).filter(s=>s!==null);t===2?(o.style.display="block",n.forEach(s=>{s.required=!0})):(o.style.display="none",n.forEach(s=>{s.required=!1}))}function me(e){let o=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),t=o?o.dataset.editionslug:"",c=e.dataset.roomslug,n=document.getElementById("Guests");if(!t||!c||!n)return;let r=z().find(l=>l.editionSlug===t&&l.roomSlug===c);r&&r.maxOccupancy&&r.maxOccupancy==="1"?(n.value="1",n.disabled=!0,n.dispatchEvent(new Event("change"))):n.disabled=!1}function I(){let e=document.querySelectorAll(".price-info-card"),t=document.querySelector("#dates-start-end-group").rangepicker,c=document.querySelector("#destination-dropdown .dropdown-selected-value .dropdown-item"),n=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),s=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item"),r=document.querySelector("#Guests"),l=c?c.dataset.destinationslug:"",u=n?n.dataset.editionslug:"",i=s?s.dataset.roomslug:"",a=s?s.getAttribute("data-allow-weekly-booking")==="Enabled":!1,[p,f]=t.getDates(),S=r?parseInt(r.value):0;if(l&&u&&i&&p&&f&&S>0){let w=Se(l),D=document.querySelector("#pet-travel-section");if(D)if(w&&w.allowPets==="true")D.style.display="flex";else{D.style.display="none";let q=document.querySelector("#pet-travel-checkbox"),B=document.querySelector("#pet-count-input");q&&(q.checked=!1),B&&(B.value="1")}let M=z();e.forEach(q=>{q.style.display="flex",be(q,M,u,i,p,f,S,a)});let L={day:"numeric",month:"short",year:"numeric"},R=p.toLocaleDateString("en-GB",{day:"numeric",month:"short"}).replace(",",""),H=f.toLocaleDateString("en-GB",L).replace(",","");document.querySelectorAll(".total-dates").forEach(q=>q.innerHTML=`${R} - ${H}`)}else{e.forEach(D=>D.style.display="none");let w=document.querySelector("#pet-travel-section");w&&(w.style.display="none")}}function be(e,o,t,c,n,s,r,l){function u(d){return d===1?"st":d===2?"nd":d===3?"rd":"th"}function i(d,m){d&&(d.style.display=m)}function a(d,m,y){!d||!m||(m.style.pointerEvents=y?"auto":"none",m.style.backgroundColor=y?"var(--_colors---primary)":"var(--_colors---light-silver)",m.style.opacity=y?1:.3,d.setAttribute("disabled",!y))}function p(){q.innerText="No room price found for the selected season or room.",i(R,"none"),i(w,"none"),i(D,"none"),i(L?.parentElement,"none"),i(B,"none"),i(M,"none"),a(C,Q,!1),K.forEach(d=>i(d,"none")),F&&(F.value=0)}function f(){i(R,"block"),i(w,"block"),i(L?.parentElement,"flex"),i(B,"block"),i(M,"block"),a(C,Q,!0),K.forEach(d=>i(d,"block"))}let S=J(n,s),w=e.querySelector(".room-price"),D=e.querySelector(".room-price-discount"),M=e.querySelector(".room-price-month-desc"),L=e.querySelector(".total-guests"),R=e.querySelector(".total-totalprice"),H=R.firstElementChild,q=e.querySelector(".room-price-breakdown"),B=e.querySelector(".total-dates"),C=document.querySelector("#form-next-step-btn-step-1"),Q=C?C.querySelector("a"):null,P=o.find(d=>d.editionSlug===t&&d.roomSlug===c),K=e.querySelectorAll(".price-info-card-title"),F=document.querySelector('[name="Total-Price"]');if(!P){p();return}f();let T=de(t),O=A(P.basePriceWeek),V=P.basePriceMonth,pe=P.discountMonth2,fe=P.discountMonth3,b=0,x=[],$=Math.round((s-n)/(1e3*60*60*24));if(S<1&&l&&O){i(D,"none"),w.innerText=`${h(O,g)}`,M.innerText="per week";let m=O/7*$;x.push({text:`${$} days: ${h(m,g)}`}),b=m;let y=A(P.surcharge2ndPerson,0);if(r===2&&y>0){let v=y/30*$;v>0&&(x.push({text:`2nd person surcharge: ${h(v,g)}`}),b+=v)}}else if(S>=1){let d=$,m=1,y=0,te=0,v=0,oe=A(P.surcharge2ndPerson,0),ne=r===2&&oe>0;for(;d>0;){let E=0;m===1?E=0:m===2?E=pe:m>=3&&(E=fe),y=E;let G=d>=30?30:d;te=G;let W=V*(1-E/100)/30*G;if(b+=W,x.push({text:G===30?`Month ${m}: ${h(W,g)}`:`+ ${d} days: ${h(W,g)}`,discount:E,month:m}),ne){let he=oe*(1-E/100)/30*G;v+=he}d-=G,m++}let k=x[x.length-1];if(k&&k.discount!==void 0&&k.discount>0){let E=k.month<=3?`${k.month}${u(k.month)} month`:"from 3rd month";D.innerText=`${k.discount.toFixed(1)}% discount - ${E}`,i(D,"flex"),w.innerText=`${h(V*(1-k.discount/100),g)}`,M.innerText=E}else i(D,"none"),w.innerText=`${h(V,g)}`,M.innerText="1st month";ne&&v>0&&(x.push({text:`2nd person surcharge: ${h(v,g)}`}),b+=v)}let U=0;if(T){if($>=1&&T.taxFirstMonth){let d=A(T.taxFirstMonth,0);d>0&&(U+=d*r,x.push({text:`${r===1?"Tax":`${r} x Tax`} (1st month): ${h(d,g)}`}))}if($>30&&T.taxSecondMonth){let d=A(T.taxSecondMonth,0);d>0&&(U+=d*r,x.push({text:`${r===1?"Tax":`${r} x Tax`} (2nd month): ${h(d,g)}`}))}}b+=U;let N=0,X=document.querySelector("#pet-travel-checkbox"),Z=document.querySelector("#pet-count-input");if(X&&X.checked&&Z&&T){let d=parseInt(Z.value)||0,m=A(T.petPricePerMonth,0);if(d>0&&m>0){let y=$/30;N=m*y*d,N>0&&x.push({text:`Pet${d>1?"s":""} (${d} \xD7 ${y.toFixed(1)} month${y!==1?"s":""}): ${h(N,g)}`})}}b+=N;let ee=document.querySelector("#get-membership-checkbox"),ye=80;if(ee&&ee.checked){let d=ye*r,m=h(d,"EUR"),y=r===1?`1 Year Membership: ${m} (not included)`:`${r} x 1 Year Membership: ${m} (not included)`;x.push({text:y})}q.innerHTML=x.map(d=>d.text).join("<br>"),L.innerText=`${r} x Person`,H.innerText=`${h(b,g)}`,F&&(F.value=`${h(b,g)}`)}})();
