(()=>{function oe(e){let t=document.querySelectorAll(".room-price-data"),o=Array.from(t).map(n=>JSON.parse(n.textContent));return e?o.filter(n=>n.editionSlug===e):o}function z(e,t){return!e||!t?0:Math.floor((t-e)/(1e3*60*60*24*30))}function h(e,t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:t,currencyDisplay:"code"}).format(e)}function T(e,t=null){return isNaN(parseFloat(e))?t:parseFloat(e)}function ne(){document.querySelectorAll("[data-trigger]").forEach(o=>{o.addEventListener("change",()=>t(o)),t(o)});function t(o){let n=o.getAttribute("data-trigger"),s=o.value;document.querySelectorAll(`[data-condition-trigger="${n}"]`).forEach(d=>{let u=d.getAttribute("data-condition-value")===s,l=d.matches("input, select, textarea")?d:d.querySelector("input, select, textarea");d.style.display=u?"block":"none",l&&(l.required=u,u||(l.value=""))})}}function re(){document.querySelectorAll("[data-custom-dropdown]").forEach(e=>{let t=document.createElement("input");t.type="hidden",t.name=e.dataset.name||"custom-dropdown",t.setAttribute("required",e.dataset.required==="true"||!1),t.value="",e.appendChild(t);let o=e.querySelector(".dropdown-selected-value");e.querySelectorAll(".dropdown-item").forEach(s=>{s.addEventListener("click",c=>{c.preventDefault();let d=s.dataset.value,u=s.cloneNode(!0);u.style.padding=0,o.innerHTML="",o.appendChild(u),t.value=d})})})}function se(e,t,o=30){let n=document.querySelector(e),s=document.querySelector(t),c=new DateRangePicker(n,{format:"dd. MM yyyy"}),d=o;return c.setMinimumDays=u=>{d=u},c.validateDateRange=()=>{let[u,l]=c.getDates();u&&l&&Math.floor((l-u)/864e5)<d?(s.setCustomValidity(`You need to choose a minimum of ${d} days.`),c.setDates(u,new Date(u.getTime()+d*24*60*60*1e3))):s.setCustomValidity(""),s.reportValidity()},n.addEventListener("changeDate",c.validateDateRange),{rangepicker:c,datesInput:n,startDateField:s}}function fe(e){return/^HM\d{6}-\d{3}$/.test(e)}function ie(){let e=document.querySelectorAll(".form-step"),t=document.querySelectorAll(".form-wizard-step .form-wizard-step-progress"),o=0;function n(l){e.forEach((r,i)=>{r.style.display=i===l?"block":"none"}),t.forEach((r,i)=>{i<l||i===l?r.classList.add("active"):r.classList.remove("active")})}function s(){let l=e[o].querySelectorAll("input, select, textarea"),r=[];return l.forEach(i=>{let p=i.type==="hidden"||i.offsetParent===null;if(i.required&&(!i.value||i.value.trim()==="")){let S=i.dataset.name||i.name||i.placeholder||"Unnamed field";r.push(`${S} is required.`)}if(!p&&i.value&&!i.checkValidity()){let f=i.name||i.placeholder||"Unnamed field";r.push(`${f} is invalid.`)}if(i.hasAttribute("data-membership-id")&&i.value&&!fe(i.value)){let f=i.dataset.name||i.name||i.placeholder||"Membership ID";r.push(`${f} is not a valid Membership ID.`)}}),r}function c(l,r){let i=document.querySelector(l);if(!i)return;i.innerHTML="";let p=document.createElement("ul");r.forEach(f=>{let S=document.createElement("li");S.textContent=f,p.appendChild(S)}),i.appendChild(p)}function d(l){let r=document.querySelector(l);r&&(r.innerHTML="")}document.querySelectorAll(".form-next-step-btn").forEach(l=>{l.addEventListener("click",()=>{if(l.getAttribute("disabled")==="true")return;let r=s(),i=`#error-list-step-${o}`;d(i),r.length==0?(o=Math.min(o+1,e.length-1),o===e.length-1&&u(),n(o)):c(i,r)})});function u(){document.querySelectorAll('[id^="review-"]').forEach(r=>{let i=r.dataset.fieldname;try{let p=document.querySelector(`[name="${i}"]`).value;r.innerText=p}catch{}})}document.querySelectorAll(".form-previous-step-btn").forEach(l=>{l.addEventListener("click",()=>{o=Math.max(o-1,0),n(o)})}),n(o)}function ce(){document.getElementById("close-button").addEventListener("click",function(){let e=document.referrer,t=window.location.hostname,o=null;try{o=e?new URL(e).hostname:null}catch{o=null}window.history.length>1&&o===t?window.history.back():window.location.href="/"})}var y="EUR",_=null;function ae(e){let t=document.querySelectorAll(".edition-data");return Array.from(t).map(n=>JSON.parse(n.textContent)).find(n=>n.editionSlug===e)||null}function ye(e){let t=document.querySelectorAll(".destination-data");return Array.from(t).map(n=>JSON.parse(n.textContent)).find(n=>n.destinationSlug===e)||null}document.addEventListener("DOMContentLoaded",function(){ce(),ne(),ie(),re(),_=se("#dates-start-end-group","#Start-Date"),ge(),Se(),De(),he(),we()});function he(){let e=new URLSearchParams(window.location.search),t=e.get("destination"),o=e.get("edition"),n=e.get("room"),s=e.get("guests");t&&J("#destination-dropdown",t,"data-destinationslug");let c=o&&J("#edition-dropdown",o,"data-editionslug");if(n&&J("#room-dropdown",n,"data-roomslug"),s){let d=document.getElementById("Guests");d&&(d.value=s)}if(c){let d=c.dataset.startdate,u=c.dataset.enddate,l=c.dataset.editionslug||"",r=_.rangepicker;r.setOptions({minDate:d,maxDate:u}),r.setDates(d,u),j(l)}}function ge(){let e=document.querySelector("#destination-dropdown"),t=document.querySelector("#edition-dropdown"),o=t.querySelector(".dropdown-selected-value"),n=o.innerHTML,s=document.querySelector("#room-dropdown"),c=s.querySelector(".dropdown-selected-value"),d=e.querySelectorAll(".dropdown-item"),u=t.querySelectorAll(".dropdown-item"),l=s.querySelectorAll(".dropdown-item");function r(i,p){o.setAttribute("disabled",i===""?"true":"false"),c.setAttribute("disabled",i===""?"true":"false"),o.innerHTML=n,c.innerHTML=n,y=p,[...u,...l].forEach(f=>{let S=f.dataset.destinationslug===i;f.style.display=S?"flex":"none"}),j("")}r("",y),d.forEach(i=>{i.addEventListener("click",function(){r(this.dataset.destinationslug,this.dataset.currency)})})}function J(e,t,o){let n=document.querySelectorAll(`${e} .dropdown-item`),s=n&&Array.from(n).find(c=>c.getAttribute(o)===t);return s&&s.click(),s}function Se(){let t=document.querySelector("#edition-dropdown").querySelectorAll(".dropdown-item"),o=document.querySelector("#dates-start-end-group");function n(s,c,d){let u=o.rangepicker;u.setOptions({minDate:s,maxDate:c}),u.setDates(s,c),j(d)}t.forEach(s=>{s.addEventListener("click",function(){let c=this.dataset.editionslug||"";n(this.dataset.startdate,this.dataset.enddate,c)})})}function j(e){let t=document.querySelector(".additional-booking-info"),o=document.querySelector(".additional-booking-info-text");if(!t||!o)return;if(!e){t.style.display="none";return}let s=ae(e)?.additionalBookingInfo||"";s&&s.trim()!==""?(o.textContent=s,t.style.display=""):t.style.display="none"}function De(){document.querySelector("#dates-start-end-group").addEventListener("changeDate",()=>{$(),de()}),document.querySelector("#room-dropdown").querySelectorAll(".dropdown-item").forEach(d=>{d.addEventListener("click",()=>{$();let u=d.getAttribute("data-allow-weekly-booking"),l=_.rangepicker;l.setMinimumDays(u==="Enabled"?7:30),l.validateDateRange()})}),document.querySelector("#Guests").addEventListener("change",()=>{$(),le()});let s=document.querySelector("#pet-travel-checkbox"),c=document.querySelector("#pet-count-input");s&&s.addEventListener("change",()=>{$()}),c&&(c.addEventListener("input",()=>{$()}),c.addEventListener("change",()=>{$()}))}function we(){de(),$(),le()}function de(){let t=document.querySelector("#dates-start-end-group").rangepicker,o=document.querySelector(".discount-info-blue"),n=document.querySelector(".discount-info-green"),[s,c]=t.getDates(),d=z(s,c);!s||!c||d<=2?(o.style.display="flex",n.style.display="none"):(o.style.display="none",n.style.display="flex")}function le(){let e=document.querySelector("#Guests"),t=document.getElementById("member-id-second-guest-wrapper");if(!t)return;if((e?parseInt(e.value):1)===2){t.style.display="block";let n=t.querySelector("#member-id-second-guest");n&&(n.required=!0)}else{t.style.display="none";let n=t.querySelector("#member-id-second-guest");n&&(n.required=!1)}}function $(){let e=document.querySelectorAll(".price-info-card"),o=document.querySelector("#dates-start-end-group").rangepicker,n=document.querySelector("#destination-dropdown .dropdown-selected-value .dropdown-item"),s=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),c=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item"),d=document.querySelector("#Guests"),u=n?n.dataset.destinationslug:"",l=s?s.dataset.editionslug:"",r=c?c.dataset.roomslug:"",i=c?c.getAttribute("data-allow-weekly-booking")==="Enabled":!1,[p,f]=o.getDates(),S=d?parseInt(d.value):0;if(u&&l&&r&&p&&f&&S>0){let D=ye(u),w=document.querySelector("#pet-travel-section");if(w)if(D&&D.allowPets==="true")w.style.display="flex";else{w.style.display="none";let q=document.querySelector("#pet-travel-checkbox"),R=document.querySelector("#pet-count-input");q&&(q.checked=!1),R&&(R.value="1")}let M=oe();e.forEach(q=>{q.style.display="flex",qe(q,M,l,r,p,f,S,i)});let L={day:"numeric",month:"short",year:"numeric"},C=p.toLocaleDateString("en-GB",{day:"numeric",month:"short"}).replace(",",""),H=f.toLocaleDateString("en-GB",L).replace(",","");document.querySelectorAll(".total-dates").forEach(q=>q.innerHTML=`${C} - ${H}`)}else{e.forEach(w=>w.style.display="none");let D=document.querySelector("#pet-travel-section");D&&(D.style.display="none")}}function qe(e,t,o,n,s,c,d,u){function l(a){return a===1?"st":a===2?"nd":a===3?"rd":"th"}function r(a,m){a&&(a.style.display=m)}function i(a,m,g){!a||!m||(m.style.pointerEvents=g?"auto":"none",m.style.backgroundColor=g?"var(--_colors---primary)":"var(--_colors---light-silver)",m.style.opacity=g?1:.3,a.setAttribute("disabled",!g))}function p(){q.innerText="No room price found for the selected season or room.",r(C,"none"),r(D,"none"),r(w,"none"),r(L?.parentElement,"none"),r(R,"none"),r(M,"none"),i(F,Q,!1),Y.forEach(a=>r(a,"none")),G&&(G.value=0)}function f(){r(C,"block"),r(D,"block"),r(L?.parentElement,"flex"),r(R,"block"),r(M,"block"),i(F,Q,!0),Y.forEach(a=>r(a,"block"))}let S=z(s,c),D=e.querySelector(".room-price"),w=e.querySelector(".room-price-discount"),M=e.querySelector(".room-price-month-desc"),L=e.querySelector(".total-guests"),C=e.querySelector(".total-totalprice"),H=C.firstElementChild,q=e.querySelector(".room-price-breakdown"),R=e.querySelector(".total-dates"),F=document.querySelector("#form-next-step-btn-step-1"),Q=F?F.querySelector("a"):null,P=t.find(a=>a.editionSlug===o&&a.roomSlug===n),Y=e.querySelectorAll(".price-info-card-title"),G=document.querySelector('[name="Total-Price"]');if(!P){p();return}f();let I=ae(o),V=T(P.basePriceWeek),O=P.basePriceMonth,ue=P.discountMonth2,me=P.discountMonth3,v=0,x=[],A=Math.round((c-s)/(1e3*60*60*24));if(S<1&&u&&V){r(w,"none"),D.innerText=`${h(V,y)}`,M.innerText="per week";let m=V/7*A;x.push({text:`${A} days: ${h(m,y)}`}),v=m;let g=T(P.surcharge2ndPerson,0);if(d===2&&g>0){let k=g/30*A;k>0&&(x.push({text:`2nd person surcharge: ${h(k,y)}`}),v+=k)}}else if(S>=1){let a=A,m=1,g=0,Z=0,k=0,ee=T(P.surcharge2ndPerson,0),te=d===2&&ee>0;for(;a>0;){let E=0;m===1?E=0:m===2?E=ue:m>=3&&(E=me),g=E;let B=a>=30?30:a;Z=B;let U=O*(1-E/100)/30*B;if(v+=U,x.push({text:B===30?`Month ${m}: ${h(U,y)}`:`+ ${a} days: ${h(U,y)}`,discount:E,month:m}),te){let pe=ee*(1-E/100)/30*B;k+=pe}a-=B,m++}let b=x[x.length-1];if(b&&b.discount!==void 0&&b.discount>0){let E=b.month<=3?`${b.month}${l(b.month)} month`:"from 3rd month";w.innerText=`${b.discount.toFixed(1)}% discount - ${E}`,r(w,"flex"),D.innerText=`${h(O*(1-b.discount/100),y)}`,M.innerText=E}else r(w,"none"),D.innerText=`${h(O,y)}`,M.innerText="1st month";te&&k>0&&(x.push({text:`2nd person surcharge: ${h(k,y)}`}),v+=k)}let W=0;if(I){if(A>=1&&I.taxFirstMonth){let a=T(I.taxFirstMonth,0);a>0&&(W+=a,x.push({text:`Tax (1st month): ${h(a,y)}`}))}if(A>30&&I.taxSecondMonth){let a=T(I.taxSecondMonth,0);a>0&&(W+=a,x.push({text:`Tax (2nd month): ${h(a,y)}`}))}}v+=W;let N=0,K=document.querySelector("#pet-travel-checkbox"),X=document.querySelector("#pet-count-input");if(K&&K.checked&&X&&I){let a=parseInt(X.value)||0,m=T(I.petPricePerMonth,0);if(a>0&&m>0){let g=A/30;N=m*g*a,N>0&&x.push({text:`Pet${a>1?"s":""} (${a} \xD7 ${g.toFixed(1)} month${g!==1?"s":""}): ${h(N,y)}`})}}v+=N,q.innerHTML=x.map(a=>a.text).join("<br>"),L.innerText=`${d} x Person`,H.innerText=`${h(v,y)}`,G&&(G.value=`${h(v,y)}`)}})();
