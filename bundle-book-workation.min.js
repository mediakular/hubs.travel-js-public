(()=>{function z(e){let o=document.querySelectorAll(".room-price-data"),t=Array.from(o).map(i=>JSON.parse(i.textContent));return e?t.filter(i=>i.editionSlug===e):t}function J(e,o){return!e||!o?0:Math.floor((o-e)/(1e3*60*60*24*30))}function g(e,o){return new Intl.NumberFormat("de-DE",{style:"currency",currency:o,currencyDisplay:"code"}).format(e)}function A(e,o=null){return isNaN(parseFloat(e))?o:parseFloat(e)}function re(){document.querySelectorAll("[data-trigger]").forEach(t=>{t.addEventListener("change",()=>o(t)),o(t)});function o(t){let i=t.getAttribute("data-trigger"),r=t.value;document.querySelectorAll(`[data-condition-trigger="${i}"]`).forEach(n=>{let l=n.getAttribute("data-condition-value")===r,u=n.matches("input, select, textarea")?n:n.querySelector("input, select, textarea");n.style.display=l?"block":"none",u&&(u.required=l,l||(u.value=""))})}}function se(){document.querySelectorAll("[data-custom-dropdown]").forEach(e=>{let o=document.createElement("input");o.type="hidden",o.name=e.dataset.name||"custom-dropdown",o.setAttribute("required",e.dataset.required==="true"||!1),o.value="",e.appendChild(o);let t=e.querySelector(".dropdown-selected-value");e.querySelectorAll(".dropdown-item").forEach(r=>{r.addEventListener("click",a=>{a.preventDefault();let n=r.dataset.value,l=r.cloneNode(!0);l.style.padding=0,t.innerHTML="",t.appendChild(l),o.value=n})})})}function ie(e,o,t=30){let i=document.querySelector(e),r=document.querySelector(o),a=new DateRangePicker(i,{format:"dd. MM yyyy"}),n=t;return a.setMinimumDays=l=>{n=l},a.validateDateRange=()=>{let[l,u]=a.getDates();l&&u&&Math.floor((u-l)/864e5)<n?(r.setCustomValidity(`You need to choose a minimum of ${n} days.`),a.setDates(l,new Date(l.getTime()+n*24*60*60*1e3))):r.setCustomValidity(""),r.reportValidity()},i.addEventListener("changeDate",a.validateDateRange),{rangepicker:a,datesInput:i,startDateField:r}}function ye(e){return/^HM\d{6}-\d{3}$/.test(e)}function ce(){let e=document.querySelectorAll(".form-step"),o=document.querySelectorAll(".form-wizard-step .form-wizard-step-progress"),t=0;function i(u){e.forEach((s,c)=>{s.style.display=c===u?"block":"none"}),o.forEach((s,c)=>{c<u||c===u?s.classList.add("active"):s.classList.remove("active")})}function r(){let u=e[t].querySelectorAll("input, select, textarea"),s=[];return u.forEach(c=>{let f=c.type==="hidden"||c.offsetParent===null;if(c.required&&(!c.value||c.value.trim()==="")){let S=c.dataset.name||c.name||c.placeholder||"Unnamed field";s.push(`${S} is required.`)}if(!f&&c.value&&!c.checkValidity()){let h=c.name||c.placeholder||"Unnamed field";s.push(`${h} is invalid.`)}if(c.hasAttribute("data-membership-id")&&c.value&&!ye(c.value)){let h=c.dataset.name||c.name||c.placeholder||"Membership ID";s.push(`${h} is not a valid Membership ID.`)}}),s}function a(u,s){let c=document.querySelector(u);if(!c)return;c.innerHTML="";let f=document.createElement("ul");s.forEach(h=>{let S=document.createElement("li");S.textContent=h,f.appendChild(S)}),c.appendChild(f)}function n(u){let s=document.querySelector(u);s&&(s.innerHTML="")}document.querySelectorAll(".form-next-step-btn").forEach(u=>{u.addEventListener("click",()=>{if(u.getAttribute("disabled")==="true")return;let s=r(),c=`#error-list-step-${t}`;n(c),s.length==0?(t=Math.min(t+1,e.length-1),t===e.length-1&&l(),i(t)):a(c,s)})});function l(){document.querySelectorAll('[id^="review-"]').forEach(s=>{let c=s.dataset.fieldname;try{let f=document.querySelector(`[name="${c}"]`).value;s.innerText=f}catch{}})}document.querySelectorAll(".form-previous-step-btn").forEach(u=>{u.addEventListener("click",()=>{t=Math.max(t-1,0),i(t)})}),i(t)}function ae(){document.getElementById("close-button").addEventListener("click",function(){let e=document.referrer,o=window.location.hostname,t=null;try{t=e?new URL(e).hostname:null}catch{t=null}window.history.length>1&&t===o?window.history.back():window.location.href="/"})}var p="EUR",_=null;function de(e){let o=document.querySelectorAll(".edition-data");return Array.from(o).map(i=>JSON.parse(i.textContent)).find(i=>i.editionSlug===e)||null}function ge(e){let o=document.querySelectorAll(".destination-data");return Array.from(o).map(i=>JSON.parse(i.textContent)).find(i=>i.destinationSlug===e)||null}document.addEventListener("DOMContentLoaded",function(){ae(),re(),ce(),se(),_=ie("#dates-start-end-group","#Start-Date"),we(),De(),xe(),Se(),qe()});function Se(){let e=new URLSearchParams(window.location.search),o=e.get("destination"),t=e.get("edition"),i=e.get("room"),r=e.get("guests");o&&Y("#destination-dropdown",o,"data-destinationslug");let a=t&&Y("#edition-dropdown",t,"data-editionslug");if(i&&Y("#room-dropdown",i,"data-roomslug"),r){let n=document.getElementById("Guests");n&&(n.value=r)}if(a){let n=a.dataset.startdate,l=a.dataset.enddate,u=a.dataset.editionslug||"",s=_.rangepicker;s.setOptions({minDate:n,maxDate:l}),s.setDates(n,l),j(u)}}function we(){let e=document.querySelector("#destination-dropdown"),o=document.querySelector("#edition-dropdown"),t=o.querySelector(".dropdown-selected-value"),i=t.innerHTML,r=document.querySelector("#room-dropdown"),a=r.querySelector(".dropdown-selected-value"),n=e.querySelectorAll(".dropdown-item"),l=o.querySelectorAll(".dropdown-item"),u=r.querySelectorAll(".dropdown-item");function s(c,f){t.setAttribute("disabled",c===""?"true":"false"),a.setAttribute("disabled",c===""?"true":"false"),t.innerHTML=i,a.innerHTML=i;let h=document.getElementById("Guests");h&&(h.disabled=!1),p=f,[...l,...u].forEach(S=>{let w=S.dataset.destinationslug===c;S.style.display=w?"flex":"none"}),j("")}s("",p),n.forEach(c=>{c.addEventListener("click",function(){s(this.dataset.destinationslug,this.dataset.currency)})})}function Y(e,o,t){let i=document.querySelectorAll(`${e} .dropdown-item`),r=i&&Array.from(i).find(a=>a.getAttribute(t)===o);return r&&r.click(),r}function De(){let o=document.querySelector("#edition-dropdown").querySelectorAll(".dropdown-item"),t=document.querySelector("#dates-start-end-group");function i(r,a,n){let l=t.rangepicker;l.setOptions({minDate:r,maxDate:a}),l.setDates(r,a),j(n)}o.forEach(r=>{r.addEventListener("click",function(){let a=this.dataset.editionslug||"";i(this.dataset.startdate,this.dataset.enddate,a);let n=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item");n&&ue(n)})})}function j(e){let o=document.querySelector(".additional-booking-info"),t=document.querySelector(".additional-booking-info-text");if(!o||!t)return;if(!e){o.style.display="none";return}let r=de(e)?.additionalBookingInfo||"";r&&r.trim()!==""?(t.textContent=r,o.style.display=""):o.style.display="none"}function xe(){document.querySelector("#dates-start-end-group").addEventListener("changeDate",()=>{M(),le()}),document.querySelector("#room-dropdown").querySelectorAll(".dropdown-item").forEach(l=>{l.addEventListener("click",()=>{M();let u=l.getAttribute("data-allow-weekly-booking"),s=_.rangepicker;s.setMinimumDays(u==="Enabled"?7:30),s.validateDateRange(),ue(l)})}),document.querySelector("#Guests").addEventListener("change",()=>{M()});let r=document.querySelector("#pet-travel-checkbox"),a=document.querySelector("#pet-count-input");r&&r.addEventListener("change",()=>{M()}),a&&(a.addEventListener("input",()=>{M()}),a.addEventListener("change",()=>{M()}));let n=document.querySelector("#get-membership-checkbox");n&&n.addEventListener("change",()=>{M()})}function qe(){le(),M()}function le(){let o=document.querySelector("#dates-start-end-group").rangepicker,t=document.querySelector(".discount-info-blue"),i=document.querySelector(".discount-info-green"),[r,a]=o.getDates(),n=J(r,a);!r||!a||n<=2?(t.style.display="flex",i.style.display="none"):(t.style.display="none",i.style.display="flex")}function ue(e){let o=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),t=o?o.dataset.editionslug:"",i=e.dataset.roomslug,r=document.getElementById("Guests");if(!t||!i||!r)return;let n=z().find(l=>l.editionSlug===t&&l.roomSlug===i);n&&n.maxOccupancy&&n.maxOccupancy==="1"?(r.value="1",r.disabled=!0,r.dispatchEvent(new Event("change"))):r.disabled=!1}function M(){let e=document.querySelectorAll(".price-info-card"),t=document.querySelector("#dates-start-end-group").rangepicker,i=document.querySelector("#destination-dropdown .dropdown-selected-value .dropdown-item"),r=document.querySelector("#edition-dropdown .dropdown-selected-value .dropdown-item"),a=document.querySelector("#room-dropdown .dropdown-selected-value .dropdown-item"),n=document.querySelector("#Guests"),l=i?i.dataset.destinationslug:"",u=r?r.dataset.editionslug:"",s=a?a.dataset.roomslug:"",c=a?a.getAttribute("data-allow-weekly-booking")==="Enabled":!1,[f,h]=t.getDates(),S=n?parseInt(n.value):0;if(l&&u&&s&&f&&h&&S>0){let w=ge(l),D=document.querySelector("#pet-travel-section");if(D)if(w&&w.allowPets==="true")D.style.display="flex";else{D.style.display="none";let q=document.querySelector("#pet-travel-checkbox"),B=document.querySelector("#pet-count-input");q&&(q.checked=!1),B&&(B.value="1")}let P=z();e.forEach(q=>{q.style.display="flex",Ee(q,P,u,s,f,h,S,c)});let L={day:"numeric",month:"short",year:"numeric"},R=f.toLocaleDateString("en-GB",{day:"numeric",month:"short"}).replace(",",""),H=h.toLocaleDateString("en-GB",L).replace(",","");document.querySelectorAll(".total-dates").forEach(q=>q.innerHTML=`${R} - ${H}`)}else{e.forEach(D=>D.style.display="none");let w=document.querySelector("#pet-travel-section");w&&(w.style.display="none")}}function Ee(e,o,t,i,r,a,n,l){function u(d){return d===1?"st":d===2?"nd":d===3?"rd":"th"}function s(d,m){d&&(d.style.display=m)}function c(d,m,y){!d||!m||(m.style.pointerEvents=y?"auto":"none",m.style.backgroundColor=y?"var(--_colors---primary)":"var(--_colors---light-silver)",m.style.opacity=y?1:.3,d.setAttribute("disabled",!y))}function f(){q.innerText="No room price found for the selected season or room.",s(R,"none"),s(w,"none"),s(D,"none"),s(L?.parentElement,"none"),s(B,"none"),s(P,"none"),c(C,Q,!1),K.forEach(d=>s(d,"none")),G&&(G.value=0)}function h(){s(R,"block"),s(w,"block"),s(L?.parentElement,"flex"),s(B,"block"),s(P,"block"),c(C,Q,!0),K.forEach(d=>s(d,"block"))}let S=J(r,a),w=e.querySelector(".room-price"),D=e.querySelector(".room-price-discount"),P=e.querySelector(".room-price-month-desc"),L=e.querySelector(".total-guests"),R=e.querySelector(".total-totalprice"),H=R.firstElementChild,q=e.querySelector(".room-price-breakdown"),B=e.querySelector(".total-dates"),C=document.querySelector("#form-next-step-btn-step-1"),Q=C?C.querySelector("a"):null,I=o.find(d=>d.editionSlug===t&&d.roomSlug===i),K=e.querySelectorAll(".price-info-card-title"),G=document.querySelector('[name="Total-Price"]');if(!I){f();return}h();let T=de(t),O=A(I.basePriceWeek),V=I.basePriceMonth,me=I.discountMonth2,pe=I.discountMonth3,b=0,x=[],$=Math.round((a-r)/(1e3*60*60*24));if(S<1&&l&&O){s(D,"none"),w.innerText=`${g(O,p)}`,P.innerText="per week";let m=O/7*$;x.push({text:`${$} days: ${g(m,p)}`}),b=m;let y=A(I.surcharge2ndPerson,0);if(n===2&&y>0){let v=y/30*$;v>0&&(x.push({text:`2nd person surcharge: ${g(v,p)}`}),b+=v)}}else if(S>=1){let d=$,m=1,y=0,te=0,v=0,oe=A(I.surcharge2ndPerson,0),ne=n===2&&oe>0;for(;d>0;){let E=0;m===1?E=0:m===2?E=me:m>=3&&(E=pe),y=E;let F=d>=30?30:d;te=F;let W=V*(1-E/100)/30*F;if(b+=W,x.push({text:F===30?`Month ${m}: ${g(W,p)}`:`+ ${d} days: ${g(W,p)}`,discount:E,month:m}),ne){let he=oe*(1-E/100)/30*F;v+=he}d-=F,m++}let k=x[x.length-1];if(k&&k.discount!==void 0&&k.discount>0){let E=k.month<=3?`${k.month}${u(k.month)} month`:"from 3rd month";D.innerText=`${k.discount.toFixed(1)}% discount - ${E}`,s(D,"flex"),w.innerText=`${g(V*(1-k.discount/100),p)}`,P.innerText=E}else s(D,"none"),w.innerText=`${g(V,p)}`,P.innerText="1st month";ne&&v>0&&(x.push({text:`2nd person surcharge: ${g(v,p)}`}),b+=v)}let U=0;if(T){if($>=1&&T.taxFirstMonth){let d=A(T.taxFirstMonth,0);d>0&&(U+=d*n,x.push({text:`${n===1?"Tax":`${n} x Tax`} (1st month): ${g(d,p)}`}))}if($>30&&T.taxSecondMonth){let d=A(T.taxSecondMonth,0);d>0&&(U+=d*n,x.push({text:`${n===1?"Tax":`${n} x Tax`} (2nd month): ${g(d,p)}`}))}}b+=U;let N=0,X=document.querySelector("#pet-travel-checkbox"),Z=document.querySelector("#pet-count-input");if(X&&X.checked&&Z&&T){let d=parseInt(Z.value)||0,m=A(T.petPricePerMonth,0);if(d>0&&m>0){let y=$/30;N=m*y*d,N>0&&x.push({text:`Pet${d>1?"s":""} (${d} \xD7 ${y.toFixed(1)} month${y!==1?"s":""}): ${g(N,p)}`})}}b+=N;let ee=document.querySelector("#get-membership-checkbox"),fe=80;if(ee&&ee.checked){let d=fe*n,m=g(d,p),y=n===1?`1 Year Membership: ${m} (not included)`:`${n} x 1 Year Membership: ${m} (not included)`;x.push({text:y})}q.innerHTML=x.map(d=>d.text).join("<br>"),L.innerText=`${n} x Person`,H.innerText=`${g(b,p)}`,G&&(G.value=`${g(b,p)}`)}})();
